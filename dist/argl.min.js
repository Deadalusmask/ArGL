!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("gl-matrix"),require("hammerjs"),require("webgl-obj-loader")):"function"==typeof define&&define.amd?define(["gl-matrix","hammerjs","webgl-obj-loader"],e):"object"==typeof exports?exports.ArGL=e(require("gl-matrix"),require("hammerjs"),require("webgl-obj-loader")):t.ArGL=e(t.window,t.Hammer,t.OBJ)}(window,function(t,e,i){return function(t){var e={};function i(r){if(e[r])return e[r].exports;var o=e[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,i),o.l=!0,o.exports}return i.m=t,i.c=e,i.d=function(t,e,r){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)i.d(r,o,function(e){return t[e]}.bind(null,o));return r},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=3)}([function(e,i){e.exports=t},function(t,i){t.exports=e},function(t,e){t.exports=i},function(t,e,i){"use strict";i.r(e);var r={};i.r(r),i.d(r,"mobilecheck",function(){return s}),i.d(r,"loadImage",function(){return n}),i.d(r,"loadBinary",function(){return a});var o=i(2);function s(){let t=!1;var e;return e=navigator.userAgent||navigator.vendor||window.opera,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))&&(t=!0),t}function n(t,e){return new Promise((i,r)=>{let o=new XMLHttpRequest,s=!1;o.open("GET",t,!0),o.responseType="arraybuffer",o.onprogress=function(t){t.lengthComputable?e(Math.round(t.loaded/t.total*100)):s||(s=!0,e(-1))},o.onloadend=function(){if(o.status.toString().match(/^2/)){s||e(100);let t={},r=o.getAllResponseHeaders().match(/^Content-Type\:\s*(.*?)$/im);r&&r[1]&&(t.type=r[1]);let n=new Blob([this.response],t),a=window.URL.createObjectURL(n),l=new Image;l.src=a,l.onload=(()=>i(l))}else r(o)},o.send()})}function a(t,e){return new Promise((i,r)=>{let o=new XMLHttpRequest,s=!1;o.open("GET",t,!0),o.responseType="arraybuffer",o.onprogress=function(t){t.lengthComputable?e(Math.round(t.loaded/t.total*100)):s||(s=!0,e(-1))},o.onloadend=function(){o.status.toString().match(/^2/)?(s||e(100),i(this.response)):r(o)},o.send()})}var l=i(1);class h{constructor(t,e,i){let r=c(t,t.VERTEX_SHADER,e),o=c(t,t.FRAGMENT_SHADER,i),s=t.createProgram();if(t.attachShader(s,r),t.attachShader(s,o),t.linkProgram(s),t.deleteShader(r),t.deleteShader(o),!t.getProgramParameter(s,t.LINK_STATUS))return console.error("Unable to initialize the shader program: "+t.getProgramInfoLog(s)),null;this.gl=t,this.program=s}use(){this.gl.useProgram(this.program)}setBool(t,e){this.gl.uniform1i(this.gl.getUniformLocation(this.program,t),Number(e))}setInt(t,e){this.gl.uniform1i(this.gl.getUniformLocation(this.program,t),Math.round(Number(e)))}setFloat(t,e){this.gl.uniform1f(this.gl.getUniformLocation(this.program,t),Number(e))}setVec2(t,e){this.gl.uniform2fv(this.gl.getUniformLocation(this.program,t),e)}setVec3(t,e){this.gl.uniform3fv(this.gl.getUniformLocation(this.program,t),e)}setVec4(t,e){this.gl.uniform4fv(this.gl.getUniformLocation(this.program,t),e)}setMat2(t,e){this.gl.uniformMatrix2fv(this.gl.getUniformLocation(this.program,t),!1,e)}setMat3(t,e){this.gl.uniformMatrix3fv(this.gl.getUniformLocation(this.program,t),!1,e)}setMat4(t,e){this.gl.uniformMatrix4fv(this.gl.getUniformLocation(this.program,t),!1,e)}}function c(t,e,i){const r=t.createShader(e);return t.shaderSource(r,i),t.compileShader(r),t.getShaderParameter(r,t.COMPILE_STATUS)?r:(console.error("An error occurred compiling the shaders: "+t.getShaderInfoLog(r)),t.deleteShader(r),null)}const u={desktopInput:!0,touchInput:!0};class d{constructor(t,e){this.options=e?Object.assign(u,e):u,this.canvas=t,this.loadProgress=0,this.resource={images:[]},this.resourceCount=0,this._loadProgresses=[];let i=this;if(this.loadProgresses=new Proxy(this._loadProgresses,{set:function(t,e,r,o){let s=i._loadProgresses.reduce((t,e)=>t+Number(e),0);if(0!==i.resourceCount&&i.loadProgress!==s/i.resourceCount){i.loadProgress=s/i.resourceCount;let t=new CustomEvent("progress",{detail:i.loadProgress});i.canvas.dispatchEvent(t)}return Reflect.set(t,e,r,o)}}),this.gl=this.canvas.getContext("webgl2"),!this.gl)return console.error("Unable to initialize WebGL2. Your browser or machine may not support it."),null;if(this.deltaTime=0,this.lastFrame=0,s()?this.mobile=!0:this.mobile=!1,this.options.desktopInput){let t={lockPointer:!0};"boolean"!=typeof this.options.desktopInput&&(t=this.options.desktopInput);let{currentlyPressedKeys:e,mouseInput:i}=d.desktopInput(this.canvas,t);this.currentlyPressedKeys=e,this.mouseInput=i}this.options.touchInput&&(this.touchInput=d.touchInput(this.canvas))}resize(){let t=this.canvas.clientWidth,e=this.canvas.clientHeight;this.canvas.width==t&&this.canvas.height==e||(this.canvas.width=t,this.canvas.height=e),this.gl.viewport(0,0,this.gl.canvas.width,this.gl.canvas.height)}draw(t){}started(){}render(t){this.deltaTime=t-this.lastFrame,this.lastFrame=t,this.resize(),this.draw(t),this.options.touchInput&&this.touchInput.reset(),this.options.desktopInput&&this.mouseInput.reset(),requestAnimationFrame(this.render.bind(this))}loadMesh(t){let e=new o.Mesh(t);return Object(o.initMeshBuffers)(this.gl,e),e}setMeshVAO(t,e){let i=this.gl.getAttribLocation(e.program,"a_position"),r=this.gl.getAttribLocation(e.program,"a_texCoord"),o=this.gl.getAttribLocation(e.program,"a_normal"),s=this.gl.createVertexArray();return this.gl.bindVertexArray(s),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,t.vertexBuffer),this.gl.vertexAttribPointer(i,3,this.gl.FLOAT,!1,0,0),this.gl.enableVertexAttribArray(i),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,t.textureBuffer),this.gl.vertexAttribPointer(r,2,this.gl.FLOAT,!1,0,0),this.gl.enableVertexAttribArray(r),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,t.normalBuffer),this.gl.vertexAttribPointer(o,3,this.gl.FLOAT,!1,0,0),this.gl.enableVertexAttribArray(o),this.gl.bindVertexArray(null),s}drawMesh(t,e){this.gl.bindVertexArray(e),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,t.indexBuffer),this.gl.drawElements(this.gl.TRIANGLES,t.indexBuffer.numItems,this.gl.UNSIGNED_SHORT,0),this.gl.bindVertexArray(null)}async start(){let t=await this.loadTexture();this.render(this.lastFrame),this.textures=t,this.started()}setImageResource(t){this.resource.images=t}async loadTexture(){let t=[];this.resourceCount+=this.resource.images.length;let e=this.resource.images.map((t,e)=>n(t,t=>{this.loadProgresses[e]=t})),i=await Promise.all(e);return this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!0),i.forEach((e,i)=>{t[i]=this.gl.createTexture(),this.gl.activeTexture(this.gl.TEXTURE0+i),this.gl.bindTexture(this.gl.TEXTURE_2D,t[i]),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,e),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR)}),t}}var m;d.loadImage=n,(m=d).desktopInput=function(t,e){let i=new Map,r={deltaX:0,deltaY:0,wheelDeltaY:0};function o(t){i.set(t.key,!0)}function s(t){i.set(t.key,!1)}function n(t){r.deltaX=t.movementX||0,r.deltaY=t.movementY||0,r.drag&&(r.dragX=t.movementX||0,r.dragY=t.movementY||0)}function a(t){r.wheelDeltaY=t.wheelDeltaY}function l(){r.drag=!0,r.dragX=0,r.dragY=0}function h(){r.drag=!1}function c(){document.addEventListener("keydown",o),document.addEventListener("keyup",s),document.addEventListener("mousemove",n),document.addEventListener("mousedown",l),document.addEventListener("mouseup",h),document.addEventListener("wheel",a)}function u(){document.removeEventListener("keydown",o),document.removeEventListener("keyup",s),document.removeEventListener("mousemove",n),document.removeEventListener("mousedown",l),document.removeEventListener("mouseup",h),document.removeEventListener("wheel",a)}if(e.lockPointer){function d(){document.pointerLockElement===t||document.mozPointerLockElement===t?c():u()}t.requestPointerLock=t.requestPointerLock||t.mozRequestPointerLock,t.exitPointerLock=t.exitPointerLock||t.mozExitPointerLock,t.onclick=function(){t.requestPointerLock()},document.addEventListener("pointerlockchange",d,!1),document.addEventListener("mozpointerlockchange",d,!1)}else t.contentEditable="true",t.style.cursor="default",t.addEventListener("focus",c),t.addEventListener("blur",u);return r.reset=function(){this.deltaX=0,this.deltaY=0,this.drag&&(this.dragX=0,this.dragY=0),this.wheelDeltaY=0},{currentlyPressedKeys:i,mouseInput:r}},m.touchInput=function(t){let e={lastX:0,lastY:0,deltaX:0,deltaY:0},i={scale:0,lastScale:1},r=new l.Manager(t);r.add(new l.Pan({direction:l.DIRECTION_ALL,threshold:10})),r.add(new l.Pinch({threshold:0})),r.on("panstart",function(t){e.lastX=0,e.lastY=0,e.deltaX=t.deltaX,e.deltaY=t.deltaY}),r.on("panmove",function(t){e.deltaX=t.deltaX-e.lastX,e.deltaY=t.deltaY-e.lastY,e.lastX=t.deltaX,e.lastY=t.deltaY}),r.on("pinchstart",function(){i.scale=0,i.lastScale=1}),r.on("pinchmove",function(t){i.scale=t.scale/i.lastScale-1,i.lastScale=t.scale});let o={pan:e,pitch:i,reset:function(){this.pan.deltaX=0,this.pan.deltaY=0,this.pitch.scale=0}};return o},function(t){const e=[-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0],i="#version 300 es\n\n  layout (location = 0) in vec3 a_position;\n  layout (location = 1) in vec2 a_texCoord;\n\n  out vec2 TexCoord;\n\n  void main()\n  {\n      TexCoord = a_texCoord;\n      gl_Position = vec4(a_position, 1.0);\n  }\n  ",r="#version 300 es\n\n  precision mediump float;\n\n  out vec4 FragColor;\n  in vec2 TexCoord;\n\n  uniform sampler2D depthMap;\n\n  void main()\n  {\n    float depthValue = texture(depthMap, TexCoord).r;\n    FragColor = vec4(vec3(depthValue), 1.0);\n  }\n  ";t.prototype.drawQuad=function(t){if(void 0===this.quadVAO){this.quadVAO=this.gl.createVertexArray();let t=this.gl.createBuffer();this.gl.bindVertexArray(this.quadVAO),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,t),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array(e),this.gl.STATIC_DRAW),this.gl.enableVertexAttribArray(0),this.gl.vertexAttribPointer(0,3,this.gl.FLOAT,!0,20,0),this.gl.enableVertexAttribArray(1),this.gl.vertexAttribPointer(1,2,this.gl.FLOAT,!0,20,12),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null),this.gl.bindVertexArray(null)}if(this.gl.bindVertexArray(this.quadVAO),1===t.length)this.gl.bindTexture(this.gl.TEXTURE_2D,t[0]);else for(let e in t)this.gl.activeTexture(this.gl.TEXTURE0+Number(e)),this.gl.bindTexture(this.gl.TEXTURE_2D,t[e]);this.gl.drawArrays(this.gl.TRIANGLE_STRIP,0,4),this.gl.bindVertexArray(null)},t.prototype.drawFB=function(t){void 0===this.fbShader&&(this.fbShader=new h(this.gl,i,"#version 300 es\n\n  precision mediump float;\n\n  out vec4 FragColor;\n  in vec2 TexCoord;\n\n  uniform sampler2D scene;\n\n  void main()\n  {\n    FragColor = texture(scene, TexCoord);\n  }\n  ")),this.fbShader.use(),this.fbShader.setInt("scene",0),this.drawQuad([t])},t.prototype.drawDepth=function(t){void 0===this.fbShader&&(this.fbShader=new h(this.gl,i,r)),this.fbShader.use(),this.fbShader.setInt("depthMap",0),this.drawQuad([t])},t.prototype.QuadVertices=[-1,1,0,-1,-1,0,1,1,0,1,-1,0],t.prototype.QuadVerticesWithUV=e,t.prototype.FBVS=i,t.prototype.FBFS=i,t.prototype.DEPTHFS=r}(d);var g=d,p=i(0);var f=class{constructor(t=[0,0,0],e=[0,0,0,1],i=45){this.position=t,this.orientation=e,this.zoom=i,this.update()}getViewMatrix(){this.update();let t=p.vec3.add([],this.position,this.front);return p.mat4.lookAt([],this.position,t,this.up)}translate(t){p.vec3.add(this.position,this.position,t)}rotate(t,e){p.quat.mul(this.orientation,this.orientation,p.quat.setAxisAngle([],e,t)),this.update()}yaw(t){this.rotate(t,this.up)}pitch(t){this.rotate(t,this.right)}roll(t){this.rotate(t,this.front)}update(){let t=p.mat4.fromQuat([],this.orientation);this.right=[-t[0],-t[4],-t[8]],this.up=[t[1],t[5],t[9]],this.front=[t[2],t[6],t[10]]}processZoom(t){this.zoom>=1&&this.zoom<=45&&(this.zoom-=t/200),this.zoom<=1&&(this.zoom=1),this.zoom>=45&&(this.zoom=45)}};function v(t,e,i){let r=p.vec3.create(),o=p.vec3.create(),s=p.vec3.create();return p.vec3.normalize(e,e),p.vec3.scale(o,t,Math.cos(i)),p.vec3.cross(s,e,t),p.vec3.scale(s,s,Math.sin(i)),p.vec3.add(r,o,s),p.vec3.normalize(r,r),r}var b=class extends f{constructor(t=[0,0,5],e=[0,0,0],i=45){let r=p.vec3.create();p.vec3.sub(r,e,t),p.vec3.normalize(r,r);let o=[r[0],0,r[2]],s=[0,r[1],Math.sqrt(1-r[1]**2)],n=0===p.vec3.length(o)?0:p.vec3.angle([0,0,1],o);n=r[0]>0?-n:n;let a=0===p.vec3.length(s)?0:p.vec3.angle([0,0,1],s);a=r[1]>0?-a:a,super(t,p.quat.create(),i),this.yaw(n),this.pitch(a),this.center=e,this.distance=p.vec3.distance(e,t)}processRotate(t,e){let i=p.vec3.create();p.vec3.scale(i,this.front,-1),i=v(i,[0,1,0],-t);let r=p.vec3.create();p.vec3.cross(r,this.up,i),i=v(i,r,-e),p.vec3.scale(i,i,this.distance),this.position=i,this.rotate(t,[0,1,0]),this.pitch(e)}desktopOrbitControl(t){if(t.mouseInput.drag){let e=t.mouseInput.dragX/t.canvas.clientWidth*Math.PI*2,i=t.mouseInput.dragY/t.canvas.clientHeight*Math.PI*2;this.processRotate(e,i)}this.processZoom(t.mouseInput.wheelDeltaY)}mobileOrbitControl(t){let e=t.touchInput.pan.deltaX/t.canvas.clientWidth*Math.PI*2,i=t.touchInput.pan.deltaY/t.canvas.clientHeight*Math.PI*2;this.processRotate(e,i),this.processZoom(1e4*t.touchInput.pitch.scale)}};class w extends f{processMove(t,e){t==w.Movement.FORWARD&&this.translate(p.vec3.scale([],this.front,e)),t==w.Movement.BACKWARD&&this.translate(p.vec3.scale([],this.front,-e)),t==w.Movement.LEFT&&this.translate(p.vec3.scale([],this.right,-e)),t==w.Movement.RIGHT&&this.translate(p.vec3.scale([],this.right,e)),t==w.Movement.UP&&this.translate(p.vec3.scale([],this.up,e)),t==w.Movement.DOWN&&this.translate(p.vec3.scale([],this.up,-e))}desktopFreeMoveControl(t,e,i,r=["w","s","a","d"," ","Shift","q","e"]){let o=t.currentlyPressedKeys;o.get(r[0])&&this.processMove(w.Movement.FORWARD,e),o.get(r[1])&&this.processMove(w.Movement.BACKWARD,e),o.get(r[2])&&this.processMove(w.Movement.LEFT,e),o.get(r[3])&&this.processMove(w.Movement.RIGHT,e),o.get(r[4])&&this.processMove(w.Movement.UP,e),o.get(r[5])&&this.processMove(w.Movement.DOWN,e);let s=t=>t/180*Math.PI;if(t.currentlyPressedKeys.get(r[6])&&this.roll(s(5*-e)),t.currentlyPressedKeys.get(r[7])&&this.roll(s(5*e)),t.options.desktopInput&&!1!==t.options.desktopInput.lockPointer){let e=s(t.mouseInput.deltaX*i),r=s(t.mouseInput.deltaY*i);this.pitch(r),this.rotate(e,[0,1,0])}else if(t.mouseInput.drag){let e=t.mouseInput.dragX/t.canvas.clientWidth*Math.PI*2,i=t.mouseInput.dragY/t.canvas.clientHeight*Math.PI*2;this.pitch(i),this.rotate(e,[0,1,0])}this.processZoom(t.mouseInput.wheelDeltaY)}}w.Movement={FORWARD:0,BACKWARD:1,LEFT:2,RIGHT:3,UP:4,DOWN:5};var A=w;i.d(e,"ArGL",function(){return g}),i.d(e,"Camera",function(){return f}),i.d(e,"Shader",function(){return h}),i.d(e,"OrbitCamera",function(){return b}),i.d(e,"FreeMoveCamera",function(){return A}),i.d(e,"util",function(){return r});e.default=g}])});